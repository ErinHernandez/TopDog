# Draft Alerts System

Complete alert system for Dynamic Island and web notifications.

## Overview

The draft alerts system provides 5 distinct alert types that notify users of critical draft events:
1. Draft Room Filled
2. Draft Starting
3. Two Picks Away
4. On The Clock
5. 10 Seconds Remaining

## Push Notifications Status

### ✅ Current Implementation (Sandbox Ready)
- **Web Notifications:** Works when browser tab is open (even if hidden)
- **Service Worker:** Integrated with click handlers
- **All Devices:** Works on iOS, Android, Desktop browsers
- **Limitation:** Does not work when browser/app is completely closed

### ⏳ Planned: True Push Notifications
- **FCM Integration:** Planned for Phase 2 (see `docs/PUSH_NOTIFICATIONS_PLAN.md`)
- **Server-Side Push:** Planned for Phase 3
- **Full Coverage:** Will work even when app is closed

**For sandbox testing:** Current web notifications work perfectly when tab is open/hidden.

## Architecture

- **Alert Manager**: Core logic for triggering, deduplication, and delivery
- **Dynamic Island Alerts**: iOS 16.1+ native implementation
- **Web Notifications**: Fallback for all other devices
- **Audio Alerts**: Sound and haptic feedback for urgent alerts
- **React Hook**: `useDraftAlerts` for integration with draft rooms

## Key Features

- ✅ Individual alert preferences (users can enable/disable each type)
- ✅ Turn-based deduplication (alerts fire in different rounds of snake drafts)
- ✅ Tab visibility awareness (no notifications when viewing draft)
- ✅ Audio/haptic feedback for urgent alerts
- ✅ Complete service worker integration
- ✅ iOS native bridge support

## Usage

```typescript
import { useDraftAlerts } from '@/components/vx2/draft-logic/hooks/useDraftAlerts';

// In your draft room component
useDraftAlerts({
  roomId,
  participants,
  maxParticipants,
  roomStatus,
  preDraftCountdown,
  picksUntilMyTurn,
  isMyTurn,
  timer,
  currentRound,
  currentPick,
});
```

## Service Worker Integration

**Note**: The service worker is auto-generated by `next-pwa`. To add the notification click handler:

1. Option A: Use next-pwa's custom worker option (if available in your version)
2. Option B: Manually append `public/sw-custom.js` content to generated `sw.js` after build
3. Option C: Use a post-build script to merge custom handlers

See `public/sw-custom.js` for the notification click handler code.

## Testing

Run unit tests:
```bash
npm test -- alertManager.test.ts
```

Test on device:
- iOS: iPhone 14 Pro+ with iOS 16.1+
- Web: Any browser with notification permissions

## Files

- `types.ts` - Type definitions
- `constants.ts` - Configuration constants
- `alertManager.ts` - Core alert management
- `audioAlerts.ts` - Sound and haptic feedback
- `dynamicIslandAlerts.ts` - iOS Dynamic Island implementation
- `webNotifications.ts` - Web notification fallback
